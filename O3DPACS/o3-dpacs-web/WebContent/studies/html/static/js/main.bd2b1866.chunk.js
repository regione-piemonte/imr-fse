(this["webpackJsonphtml-viewer"]=this["webpackJsonphtml-viewer"]||[]).push([[0],{270:function(e,t,n){e.exports=n(523)},470:function(e,t,n){},479:function(e,t,n){},480:function(e,t,n){},481:function(e,t,n){},482:function(e,t,n){},483:function(e,t,n){},484:function(e,t,n){},495:function(e,t,n){},510:function(e,t){},512:function(e,t){},522:function(e,t,n){},523:function(e,t,n){"use strict";n.r(t);n(271),n(281);var i=n(0),a=n.n(i),r=n(45),o=n.n(r),c=(n(470),n(46)),s=n(62),l=n(63),u=n(69),d=n(67),m=n(529),f=n(530),p=n(531),h=n(268),v=n(262),g=n.n(v),w=n(131),S=n(48),y=n.n(S),b=n(5),k=n.n(b),E=n(52),C=n(15),I={IMAGE_JPEG:"image/jpeg",DICOM:"application/dicom",PDF:"application/pdf",TEXT_XML:"text/xml",VIDEO_MPEG:"video/mpeg",VIDEO_QUICKTIME:"video/quicktime"},T=(n(479),function(e){if([I.PDF,I.VIDEO_MPEG].includes(e.contentType)){var t=e.contentType===I.PDF?C.h:C.i;return a.a.createElement("div",{className:"tile-container"},a.a.createElement(E.a,{icon:t,size:"6x",onClick:e.onClick}))}return a.a.createElement("div",{className:"tile-container"},a.a.createElement("img",{className:e.className,alt:e.alt,src:e.src,onClick:e.onClick,id:e.id,active:e.active}),a.a.createElement("span",{className:"text-bottom-right"},e.brText))});n(480);function O(e,t){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return n.top<=i.top?i.top-n.top<=n.height/2:n.bottom-i.bottom<=n.height/2}var N=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(s.a)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).scrollToSelected=function(){if(document){var e=document.querySelector("#scroll-tile"),t=document.querySelector("#scroll-tile-container");e&&t&&!O(e,t)&&e.scrollIntoView(!1,{block:"nearest"})}},e.onTileClick=function(t,n){"function"===typeof e.props.onTileClick&&e.props.onTileClick(n)},e}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this.props.activeImage,n=null===e||void 0===e?void 0:e.activeImage;t&&t!==n&&this.scrollToSelected()}},{key:"render",value:function(){var e=this,t=this.props.images.map((function(t,n){var i=t===e.props.activeImage;return t&&a.a.createElement(T,{key:n,className:k()("tile-img",{"tile-img-active":i}),alt:t.number,src:t.iconUrl,contentType:t.contentType,onClick:function(n){return e.onTileClick(n,t)},id:i?"scroll-tile":null,brText:"".concat(t.numberOfFrames||"")})}));return a.a.createElement("div",{className:"tile-list"},t)}}]),n}(a.a.Component),x=n(134),D=n(263),F=n(526);function P(e){return"function"===typeof e||e instanceof Function}function z(e){return"string"===typeof e||e instanceof String}function M(e){return Array.isArray(e)}function A(e){return Array.isArray(e)&&e.length>0}var R=function(e){if(!e.series)return null;var t="".concat(e.series.modality," - ").concat(e.series.description," - ").concat(e.series.numberOfInstances);return a.a.createElement(D.a,{action:!0,active:e.active,className:"app-list-group-item list-group-item py-1 text-left",onClick:function(){P(e.onClick)&&e.onClick(e.series)},title:t,"data-class":"SeriesListItem","data-description":e.series.description},a.a.createElement(E.a,{icon:C.c,className:k()("app-fa-icon",{"app-fa-icon-active":e.active})}),a.a.createElement("span",{className:"ml-4"},t))},U=function(e){var t,n=null===(t=e.series)||void 0===t?void 0:t.map((function(t,n){var i,r=(null===t||void 0===t?void 0:t.uid)===(null===(i=e.activeSeries)||void 0===i?void 0:i.uid);return a.a.createElement(R,{key:n,series:t,active:r,onClick:e.onClick})}));return a.a.createElement(F.a,{className:"app-list-group"},n)};function L(e){var t=["PR"];return e.filter((function(e){return!t.includes(e.modality)}))}function j(e){if(e){var t=e.instances;if(M(t))if(t.find((function(e){return e.rows>0})))return!0}return!1}n(481);var W=function(e){var t=e.study,n=e.active;if(!t)return null;var i=t.isOffline(),r=n?L(t.series):[],o=t.date+" "+t.time+(i?" (OFFLINE)":"")+"\n"+t.description+"\n"+t.accessionNumber;return a.a.createElement(D.a,{key:t.uid,className:"list-group-item text-left app-backgroud app-list-group-item-border py-1",onClick:function(){P(e.onStudyClick)&&e.onStudyClick(t)},title:o},a.a.createElement("div",{variant:"contained",className:"d-flex align-items-center app-list-group-item py-1"},a.a.createElement(E.a,{inverse:!0,size:"lg",icon:n?C.k:C.j,className:"app-fa-icon mr-2"}),a.a.createElement("h5",{className:"text-left text-truncate m-0"},t.date+" "+t.time,a.a.createElement("span",{className:"text-warning"},i?" (OFFLINE)":""),a.a.createElement("br",null),"".concat(t.description," ").concat(t.accessionNumber))),a.a.createElement(U,{series:r,activeSeries:e.activeSeries,onClick:e.onSeriesClick}))},K=function(e){var t=e.studies,n=e.activeStudy,i=Object(x.a)(e,["studies","activeStudy"]),r=t.map((function(e,t){var r=e===n;return a.a.createElement(W,Object.assign({key:t,study:e,active:r},i))}));return a.a.createElement(F.a,{className:"app-list-group"},r)},G=(n(482),function(e){var t,n=(null===(t=e.activeSeries)||void 0===t?void 0:t.instances)||[];return a.a.createElement("div",{id:e.id,className:"d-flex flex-column fit-height mr-1"},a.a.createElement("div",{className:"sidebar-row study-list mb-2"},a.a.createElement(K,{studies:e.studies,activeStudy:e.activeStudy,activeSeries:e.activeSeries,onStudyClick:e.onStudyClick,onSeriesClick:e.onSeriesClick})),a.a.createElement("div",{id:"scroll-tile-container",className:"sidebar-row"},a.a.createElement(N,{images:n,activeStudy:e.activeStudy,activeSeries:e.activeSeries,activeImage:e.activeImage,onTileClick:e.onImageClick})))});function H(e){try{return JSON.parse("".concat(e))}catch(t){return}}n(483);var Y=function(e){var t,n=k()(e.spanClasses,"Text"),i=k()(e.listClasses),r=k()("bi","bi-star"),o=(t=e.data)?Object.keys(t).map((function(e){var n="";if(e){var i=e.trim();"-"===i.substring(0,1)?i="":i.length>0&&(i="".concat(e.match(/[a-z]+/gi).map((function(e){return e.charAt(0).toUpperCase()+e.substr(1)})).join(""),":"));var a=void 0!==t[e]?t[e]:"";n="".concat(i," ").concat(a).trim()}return n})):[],c=e.fontSize||"1em",s=c,l={lineHeight:"".concat(s),fontSize:"".concat(c),listStyleType:"none",marginTop:"0px",marginBottom:"0px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},u={lineHeight:"".concat(s),fontSize:"".concat(c),listStyleType:"none",marginTop:"0px",marginBottom:"0px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"#a5a768"},d={verticalAlign:"unset"};return a.a.createElement("div",{className:e.className,style:e.style},a.a.createElement("div",{className:n},a.a.createElement("ul",{className:i},o.map((function(e,t){return e.startsWith("KEY:")?a.a.createElement("li",{key:t,style:u},a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:r,viewBox:"0 0 16 16",style:d},a.a.createElement("path",{d:"M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"}))," "+e||!1):a.a.createElement("li",{key:t,style:l},e||a.a.createElement("br",null))})))))},B=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).getOverlayData=function(){var e=i.props,t=e.patient,n=e.study,a=e.series,r=e.image,o=e.windowWidth,c=e.windowCenter,s=e.scale,l=e.rotation,u=e.horzFlip,d=e.frameNumber,m=e.cineFps,f={tl:{},tr:{},br:{},bl:{}};if(t&&n&&(f.tl.patientName=t.lastName+" "+t.firstName,f.tl.patientId=t.patientID,f.tl.birthdate=t.birthDate),n&&(f.tr["-tDescription"]=n.description||"",f.tr.date=(n.date||"")+" "+(n.time||""),f.tr.accession=n.accessionNumber||""),a&&("KO"===a.modality&&r&&r.referencedSeries?f.tr.series="".concat(r.referencedSeries.modality||""," - ").concat(r.referencedSeries.description||""):f.tr.series="".concat(a.modality||""," - ").concat(a.description||"")),r){if(m&&(f.br.FPS=m),l||u){var p="";l&&(p="Rotated ".concat(l,"\xb0")),u&&(p+=p.length>0?" + Flipped":"Flipped"),f.br["-trasformation"]=p}r.numberOfFrames>1&&d>0&&(f.br.frame="".concat(d,"/").concat(r.numberOfFrames)),f.br.window=r.windowWidth,f.br.level=r.windowCenter,o>0&&(f.br.window=o,f.br.level=c),f.br.scale=Number.isFinite(s)?Number.parseFloat(s).toFixed(2):"",f.br.quality=r.imageQuality+"%","KO"===a.modality&&(f.bl.KEY=a.codeMeaning),f.bl.number=r.number||"",f.bl.size="".concat(r.rows,"x").concat(r.columns," pixel"),f.bl.photometric=r.photometricInterpretation,r.pixelSpacing&&(f.bl.spacing="".concat(r.pixelSpacing.columnSpacing||"",", ").concat(r.pixelSpacing.rowSpacing||"")),r.imagePositionPatientX&&(f.bl.position="".concat(r.imagePositionPatientX,", ").concat(r.imagePositionPatientY,", ").concat(r.imagePositionPatientZ))}return f},i.state={fontSize:"1.2em"},i}return Object(l.a)(n,[{key:"render",value:function(){var e=this.getOverlayData(),t=this.state.fontSize;return a.a.createElement("div",{className:"OverlayGroup disable-select"},a.a.createElement(Y,{className:"OverlayGroupItem TopLeft",fontSize:t,align:"left",top:!0,data:e.tl,spanClasses:"UpperTextDiv",listClasses:"LeftUpperList"}),a.a.createElement(Y,{className:"OverlayGroupItem TopRight",fontSize:t,align:"right",top:!0,data:e.tr,spanClasses:"UpperTextDiv",listClasses:"RightUpperList"}),a.a.createElement(Y,{className:"OverlayGroupItem BottomRight",fontSize:t,align:"right",bottom:!0,data:e.br,spanClasses:"BottomTextDiv",listClasses:"RightBottomList"}),a.a.createElement(Y,{className:"OverlayGroupItem BottomLeft",fontSize:t,align:"left",bottom:!0,data:e.bl,spanClasses:"BottomTextDiv",listClasses:"LeftBottomList"}))}}]),n}(a.a.Component),X="TOGGLE_SIDEBAR",_="STACK",V="CONTRAST",$="ZOOM",Z="SCALE_TO_FIT",Q="SCALE_TO_ONE",q="PAN",J="REVERT",ee="ROTATE",te="HORZ_FLIP",ne="TOGGLE_CINE",ie="TOGGLE_INFO",ae="TOGGLE_FULLSCREEN",re="SCALE TO FIT",oe="MAGNIFY",ce=(n(484),{zoomMode:re,zoomValue:1,offsetX:0,offsetY:0,rotation:0,horzFlip:!1,windowWidth:0,windowCenter:0,frameNumber:1,dragging:!1}),se=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).clearCache=function(){i.cache={}},i.updateCine=function(){if(i.props.cineMode){i.cineTimer&&(clearInterval(i.cineTimer),i.cineTimer=null);var e=i.cineFps||30;i.cineTimer=setInterval((function(){return i.scrollFrame(1)}),1e3/e)}else i.cineTimer&&(clearInterval(i.cineTimer),i.cineTimer=null)},i.onResize=function(e){if(i.canvasRef&&i.canvasRef.current){var t=i.canvasRef.current.getContext("2d");if(t){var n=i.resizeRef.current,a=n.clientWidth-1,r=n.clientHeight-1;t.canvas.width===a&&t.canvas.height===r||(t.canvas.width=a,t.canvas.height=r,i.forceUpdate())}}},i.getImageFitScale=function(e){if(e&&e.width>0&&e.height>0){var t=i.canvasRef.current.getContext("2d").canvas,n=t.width/e.width,a=t.height/e.height;return Math.min(n,a)}return 1},i.drawImage=function(e){if(e.width>0&&e.height>0){var t=i.canvasRef.current.getContext("2d"),n=t.canvas,a=i.state,r=a.zoomMode,o=a.zoomValue,c=a.offsetX,s=a.offsetY,l=a.rotation,u=a.horzFlip,d=i.getImageFitScale(e),m=1;r===re?m=d:r===oe&&(m=o>0?o:d),t.fillRect(0,0,n.width,n.height),t.translate(n.width/2,n.height/2),t.translate(c,s),t.rotate(l*Math.PI/180),u&&t.scale(-1,1),t.scale(m,m),t.translate(-e.width/2,-e.height/2),t.drawImage(e,0,0,e.width,e.height),t.setTransform(1,0,0,1,0,0),i.drawScale=m}},i.scrollFrame=function(e){if("function"===typeof i.props.scrollFrame){var t=i.props,n=t.image,a=t.cineMode;if(n){var r=n.numberOfFrames,o=i.state.frameNumber||1;if(r>1)return o+=e,a&&o>r&&(o=1),o=Math.max(1,Math.min(o,r)),i.setState({frameNumber:o}),void i.updateCanvas(n)}(n=i.props.scrollFrame(e))&&i.updateCanvas(n)}},i.onMouseDown=function(e){},i.onMouseUp=function(e){i.setState({dragging:!1}),2===e.buttons&&e.preventDefault()},i.onStackChange=function(e){var t=Math.round(e.movementY/3);t&&i.scrollFrame(t)},i.onZoomChange=function(e){var t=e.movementY,n=7.875/window.innerHeight,a=i.drawScale-n*t;a>=.125&&a<=8&&i.setState({zoomMode:oe,zoomValue:a})},i.onPanChange=function(e){if(e.movementX||e.movementY){var t=i.state,n=t.offsetX,a=t.offsetY;e.movementX&&(n+=e.movementX),e.movementY&&(a+=e.movementY),i.setState({offsetX:n,offsetY:a})}},i.onContrastChange=function(e){if(e.movementX||e.movementY){var t=i.state,n=t.windowWidth,a=t.windowCenter;n||(n=Number.parseFloat(i.props.image.windowWidth),a=Number.parseFloat(i.props.image.windowCenter)),Number.isFinite(n)>0&&(Math.abs(e.movementX)>=Math.abs(e.movementY)?n+=e.movementX:a+=e.movementY,i.setState({windowCenter:a,windowWidth:n,dragging:!0}))}},i.onMouseMove=function(e){var t=i.props.activeTool;if(1===e.buttons)switch(t){case _:return i.onStackChange(e);case $:return i.onZoomChange(e);case q:return i.onPanChange(e);case V:return i.onContrastChange(e)}},i.onWheel=function(e){i.props.cineMode?i.scrollFps(e.deltaY):i.scrollFrame(e.deltaY>0?1:-1)},i.onContextMenu=function(e){e.preventDefault()},i.resizeRef=a.a.createRef(),i.canvasRef=a.a.createRef(),i.state=Object(c.a)({},ce),i.cache={},i.cineTimer=null,i.cineFps=30,i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.onResize(),this.updateCine()}},{key:"componentWillUnmount",value:function(){this.clearCache()}},{key:"componentDidUpdate",value:function(e){this.props.image!==(null===e||void 0===e?void 0:e.image)&&this.clearCache(),this.props.cineMode!==e.cineMode&&this.updateCine()}},{key:"updateCanvas",value:function(e){var t,n=this;if(null===(t=this.canvasRef)||void 0===t?void 0:t.current){var i=this.canvasRef.current.getContext("2d");if(e&&e.wadourl){var a=this.state,r=a.windowCenter,o=a.windowWidth,c=a.dragging,s=a.frameNumber,l=e.numberOfFrames,u=e.wadourl;s>=1&&(u+="&frameNumber="+s);var d=u;o>0&&(u+="&windowCenter="+r.toFixed(0)+"&windowWidth="+o.toFixed(0),c&&(u+="&imageQuality=25"));var m=e.bitmap;l>1&&(m=this.cache[d]),m||(m=new Image),m.src!==u&&(m.alt="",m.src="",m.onload=function(){e.bitmap=m,n.cache[d]=m,n.forceUpdate()},m.src=u),m&&m.complete&&this.drawImage(m)}else i.fillRect(0,0,i.canvas.innerWidth,i.canvas.innerHeight)}}},{key:"scrollFps",value:function(e){var t=this.cineFps+(e>0?1:-1);t=Math.max(1,Math.min(60,t)),this.cineTimer&&(this.cineFps=t,this.updateCine())}},{key:"scaleTo",value:function(e){e>=.125&&e<=8&&this.setState({zoomMode:oe,zoomValue:e})}},{key:"scaleToFit",value:function(){this.setState({zoomMode:re})}},{key:"rotateAndFlip",value:function(e,t){if(e||t){var n=this.state.horzFlip||!1,i=n,a=((this.state.rotation||0)+(e||0))%360;t&&(i=!n,a=(360-a)%360),a<0&&(a=(a+360)%360),this.setState({rotation:a,horzFlip:i})}}},{key:"rotateRight",value:function(){this.rotateAndFlip(90,!1)}},{key:"flipHorizontal",value:function(){this.rotateAndFlip(0,!0)}},{key:"flipVertical",value:function(){this.rotateAndFlip(180,!0)}},{key:"revert",value:function(){this.setState(Object(c.a)({},ce))}},{key:"render",value:function(){var e,t=this.props,n=this.state;if(t.image){e=t.image.contentType;var i=t.image.wadourl+"&contentType="+e;if(e===I.PDF)return a.a.createElement("iframe",{className:"no-space fit-parent",src:i,title:"document"});if(e===I.VIDEO_MPEG)return a.a.createElement("video",{className:"no-space fit-parent",src:i,controls:!0,title:"video"})}this.updateCanvas(t.image);var r=t.cineMode?this.cineFps:null;return a.a.createElement("div",{id:t.id,className:"no-space fit-parent",style:{backgroundColor:"black",position:"relative"},onContextMenu:this.onContextMenu,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onWheel:this.onWheel},a.a.createElement(w.a,{className:"no-space fit-parent",style:{backgroundColor:"inherit"},targetRef:this.resizeRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize},a.a.createElement("div",{className:"no-space fit-parent",ref:this.resizeRef,style:{backgroundColor:"inherit"}},a.a.createElement("canvas",{id:"canvas",className:"no-space",ref:this.canvasRef,style:{position:"absolute",top:0,left:0},onKeyDown:t.onKeyDown}))),t.showInfo&&a.a.createElement(B,{patient:t.patient,study:t.study,series:t.series,image:t.image,frameNumber:n.frameNumber,windowCenter:n.windowCenter,windowWidth:n.windowWidth,rotation:n.rotation,horzFlip:n.horzFlip,scale:this.drawScale,cineFps:r}))}}]),n}(a.a.Component),le=n(534),ue=n(533),de=n(527);var me=function(e){var t=e.children,n=(e.className,e.icon),i=e.id,r=e.onClick,o=Object(x.a)(e,["children","className","icon","id","onClick"]);return a.a.createElement(le.a.Link,Object.assign({as:"button",className:"nav-tool mx-2",id:i,onClick:function(e){P(r)&&r(e,i)}},o,{style:{fontWeight:e.active?"bold":"inherit"}}),n?a.a.createElement(E.a,{icon:n,size:"lg"}):null,a.a.createElement("span",{className:"d-inline d-lg-none ml-2"},t))},fe=function(e){var t=function(t,n){P(e.onClickTool)&&e.onClickTool(n)},n="";return e.patient&&(n=(e.patient.lastName||"")+" "+(e.patient.firstName||""),e.patient.sex&&(n+=" ("+e.patient.sex+")"),e.patient.birthDate&&(n+=" "+e.patient.birthDate)),a.a.createElement(ue.a,{id:e.id,style:{top:"inherit"},fixed:"top",bg:"dark",variant:"dark",expand:"lg"},a.a.createElement(de.a,{xs:"10",lg:"3",className:"text-left text-ellipsis"},a.a.createElement(ue.a.Brand,null,a.a.createElement(E.a,{className:"ml-0 mr-1",icon:C.t})," ",n)),a.a.createElement(ue.a.Toggle,{"aria-controls":"basic-navbar-nav"}),a.a.createElement(ue.a.Collapse,{id:"basic-navbar-nav"},a.a.createElement(le.a,{className:"mr-auto justify-content-center fit-width"},a.a.createElement(me,{id:X,onClick:t,active:e.showSidebar,icon:C.o,title:"Toggle Sidebar"},"Sidebar"),a.a.createElement(me,{id:_,onClick:t,active:e.activeTool===_,icon:C.c,title:"Stack scroll (S)"},"Stack"),a.a.createElement(me,{id:V,onClick:t,active:e.activeTool===V,icon:C.a,title:"Change contrast (W)"},"Contrast"),a.a.createElement(me,{id:q,active:e.activeTool===q,onClick:t,icon:C.l,title:"Translate Image (T)"},"Pan"),a.a.createElement(me,{id:$,onClick:t,active:e.activeTool===$,icon:C.r,title:"Change zoom (Z)"},"Zoom"),a.a.createElement(me,{id:Z,onClick:t,icon:C.f,title:"Display fitting to window (F)"},"Fit"),a.a.createElement(me,{id:Q,onClick:t,icon:C.d,title:"Display without zoom"},"1:1"),a.a.createElement(me,{id:ee,onClick:t,icon:C.q,title:"Rotate 90 degrees clockwise"},"Rotate"),a.a.createElement(me,{id:te,onClick:t,icon:C.b,title:"Flip Horizontally"},"Flip"),a.a.createElement(me,{id:ne,onClick:t,active:e.cineMode,icon:e.cineMode?C.s:C.p,title:e.cineMode?"Stop (C)":"Play (C)"},e.cineMode?"Stop":"Play"),a.a.createElement(me,{id:J,onClick:t,icon:C.m,title:"Display Reset (Esc)"},"Revert"),a.a.createElement(me,{id:ie,onClick:t,active:e.showInfo,icon:C.n,title:"Toggle Overlay (I)"},"Info"),e.fullScreenEnabled&&a.a.createElement(me,{id:ae,onClick:t,active:e.fullScreen,icon:e.fullScreen?C.e:C.g,title:"Toggle Full Screen (F11)"},"Full Screen"))))},pe=n(532),he=n(528),ve=(n(495),function(e){return a.a.createElement(pe.a,{backdrop:"static",backdropClassName:"safety-alert-backdrop",keyboard:!1,size:"lg",centered:!0,show:e.show},a.a.createElement(pe.a.Header,null,a.a.createElement(pe.a.Title,null,"Uso Previsto e Informazioni sulla Sicurezza")),a.a.createElement(pe.a.Body,null,a.a.createElement("p",{className:"text-uppercase text-center"},"Le immagini DICOM visualizzate ",a.a.createElement("u",null,"non sono destinate ad uso diagnostico"),".",a.a.createElement("br",null),"Il presente VIEWER puo' essere usato solo come software a scopo di consultazione, ricerca o insegnamento; ",a.a.createElement("u",null,"non puo' essere destinato ad uso diagnostico")," ed utilizzato a fini clinici e/o per la cura del paziente.",a.a.createElement("br",null),"Non e' un dispositivo medico con marchio CE")),a.a.createElement(pe.a.Footer,{className:"justify-content-center"},a.a.createElement(he.a,{onClick:e.onDeclineClick,variant:"danger"},"Rifiuta"),a.a.createElement(he.a,{onClick:e.onAcceptClick,variant:"success"},"Accetta")))}),ge=n(267),we=n.n(ge),Se={authorization:""};function ye(e){if(!e.ok)throw new Error("[".concat(e.status,"] ").concat(e.statusText));return e}Se.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,Object(c.a)({method:"GET",headers:{Authorization:this.authorization}},t)).then((function(e){return ye(e)}))},Se.post=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return fetch(e,Object(c.a)({method:"POST",headers:{Authorization:this.authorization,"Content-Type":"application/x-www-form-urlencoded"},body:t},n)).then((function(e){return ye(e)}))};var be={Patient:function(e){return{patientID:e.patientID,firstName:e.firstName,middleName:e.middleName,lastName:e.lastName,birthDate:e.birthDate,numberOfStudies:e.numberOfStudies,studies:[]}}},ke="p";be.Study=function(e){return{accessionNumber:e.accessionNumber,date:e.date,description:e.description,numberOfSeries:e.numberOfSeries,series:[],studyStatus:e.studyStatus,time:e.time,uid:e.uid,isOffline:function(){return this.studyStatus===ke}}},be.Series=function(e){return{description:e.description,instances:[],modality:e.modality,numberOfInstances:e.numberOfInstances,thumbnail:e.thumbnail,uid:e.uid}},be.KoSeries=function(e){var t=e.codeMeaning&&e.codeMeaning.trim().length>0?e.codeMeaning:"Key Note";return{codeMeaning:t,contentDate:e.contentDate,contentTime:e.contentTime,description:(e.contentDate+" "+e.contentTime).trim()+" "+t,instances:[],modality:"KO",numberOfInstances:e.numberOfReferencedInstances,thumbnail:e.wadourl,uid:e.uid}},be.Instance=function(e){var t={bitPerPixel:e.bitPerPixel,columns:e.columns,contentType:e.contentType,imagePositionPatientX:e.imagePositionPatientX,imagePositionPatientY:e.imagePositionPatientY,imagePositionPatientZ:e.imagePositionPatientZ,imageQuality:e.imageQuality,instanceDateTime:e.instanceDateTime,echoTime:e.echoTime,number:e.number,numberOfFrames:e.numberOfFrames,photometricInterpretation:e.photometricInterpretation,pixelSpacing:e.pixelSpacing,rescaleIntercept:e.rescaleIntercept,rescaleSlope:e.rescaleSlope,rows:e.rows,transferSyntax:e.transferSyntax,wadourl:e.wadourl,windowCenter:e.windowCenter,windowWidth:e.windowWidth,uid:e.uid,contentDate:e.contentDate,contentTime:e.contentTime,codeMeaning:e.codeMeaning,numberOfReferencedInstances:e.numberOfReferencedInstances,referencedSeriesUID:e.referencedSeries,referencedSeries:null,referencedInstances:[]};return function(e){z(e.rows)&&(e.rows=Number.parseInt(e.rows),e.columns=Number.parseInt(e.columns)),z(e.windowWidth)&&(e.windowWidth=Number.parseFloat(e.windowWidth),e.windowCenter=Number.parseFloat(e.windowCenter)),z(e.bitPerPixel)&&(e.bitPerPixel=Number.parseInt(e.bitPerPixel)),z(e.numberOfFrames)&&(e.numberOfFrames=Number.parseInt(e.numberOfFrames)),e&&e.rows>0&&e.columns>0&&e.bitPerPixel&&((e.windowWidth||0)<1&&(e.windowWidth=Math.round(1<<e.bitPerPixel),e.windowCenter=Math.round(e.windowWidth/2)),e.iconUrl=e.wadourl+"&rows=128&columns=128&contentType=image/jpeg",e.imageQuality&&(e.iconUrl+="&imageQuality=".concat(e.imageQuality)))}(t),t},be.PixelSpacing=function(e){return{columnSpacing:e.columnSpacing,rowSpacing:e.rowSpacing}};var Ee=be,Ce={serviceUrl:"/o3-dpacs-wado",retrieveAeTitle:""};function Ie(e){var t={patients:[]};return we.a.parseString(e,(function(e,n){var i;if(e)return t;var a=null===n||void 0===n||null===(i=n.results)||void 0===i?void 0:i.patient;M(a)&&a.forEach((function(e){var n=Ee.Patient(e.$);M(e.study)&&e.study.forEach((function(e){var t=Ee.Study(e.$);M(e.series)&&e.series.forEach((function(e){var n=Ee.Series(e.$);M(e.instance)&&e.instance.forEach((function(e){var t=Ee.Instance(e.$);A(e.pixelSpacing)&&(t.pixelSpacing=Ee.PixelSpacing(e.pixelSpacing[0].$)),A(e.imagerPixelSpacing)&&(t.imagerPixelSpacing=Ee.PixelSpacing(e.imagerPixelSpacing[0].$)),A(e.referencedInstance)&&e.referencedInstance.forEach((function(e){var n=Ee.Instance(e.$);A(e.pixelSpacing)&&(n.pixelSpacing=Ee.PixelSpacing(e.pixelSpacing[0].$)),A(e.imagerPixelSpacing)&&(n.imagerPixelSpacing=Ee.PixelSpacing(e.imagerPixelSpacing[0].$)),t.referencedInstances.push(n)})),n.instances.push(t)})),t.series.push(n)})),n.studies.push(t)})),t.patients.push(n)}))})),t}Ce.getPatientInfo=function(e){var t=e.showOnlyThis||!1,n="".concat(this.serviceUrl,"/getPatientInfo"),i=new URLSearchParams;return e.patientID?(i.append("patientID",e.patientID),e.idIssuer&&i.append("idIssuer",e.idIssuer),i.append("showOnlyThis",!1)):e.accessionNumber?(i.append("accessionNumber",e.accessionNumber),e.idIssuer&&i.append("idIssuer",e.idIssuer),i.append("showOnlyThis",t)):e.studyUID&&(i.append("studyUID",e.studyUID),i.append("showOnlyThis",t)),new Promise((function(e,t){return Se.post(n,i.toString()).then((function(e){return e.text()})).then((function(e){return Ie(e)})).then((function(t){return e(t)})).catch((function(e){return console.warn("getPatintInfo error",e),t(e)}))}))},Ce.getInstances=function(e){var t="".concat(this.serviceUrl,"/getInstances"),n=new URLSearchParams;n.append("studyUID",e.studyUID),n.append("seriesUID",e.seriesUID);var i=e.retrieveAeTitle||this.retrieveAeTitle;return i&&n.append("retrieveAeTitle",i),new Promise((function(e,i){return Se.post(t,n.toString()).then((function(e){return e.text()})).then((function(e){return Ie(e)})).then((function(t){return e(t)})).catch((function(e){return console.warn("getInstances error",e),i(e)}))}))};var Te=Ce,Oe=(n(521),n(522),{patient:null,activeStudy:null,activeSeries:null,activeImage:null,activeTool:_,cineMode:!1,showSidebar:!0,showInfo:!0,showSafetyAlert:!0,splitSizes:[25,75],headerTop:0,headerHeight:0,fullScreen:y.a.isEnabled&&y.a.isFullscreen,fullScreenEnabled:y.a.isEnabled}),Ne=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).verifyParameters=function(e){return!!(e.patientID||e.accessionNumber||e.studyUID)},i.onResize=function(e,t){var n={fullScreen:y.a.isFullscreen},a=document.getElementById("header");a&&(n.headerTop=a.offsetTop,n.headerHeight=a.offsetHeight),i.setState(n)},i.setActivateItem=function(e,t,n){var a={};e&&(a.activeImage=e),t&&(a.activeSeries=t),n&&(a.activeStudy=n),i.setState(a)},i.onStudyClick=function(e){if(e&&e!==i.state.activeStudy){var t=function(e){if(M(e))for(var t=0;t<e.length;t++)if(j(e[t]))return e[t];return null}(e.series);if(A(t)){var n=t.instances[0];i.setActivateItem(n,t,e)}}},i.onSeriesClick=function(e){if(e!==i.state.activeSeries){var t=A(e.instances)?e.instances[0]:null;i.setActivateItem(t,e)}},i.onImageClick=function(e){i.setActivateItem(e)},i.scrollFrame=function(e){var t=i.state,n=t.activeSeries,a=t.activeImage;if(n&&a){var r=n.instances,o=r.findIndex((function(e){return e.uid===a.uid}));if(o>=0&&(o+=e,i.state.cineMode&&o>=r.length&&(o=0),o>=0&&o<r.length)){var c=r[o];return i.setActivateItem(c),c}}return null},i.scrollSeries=function(e){var t,n=null===(t=i.state.activeStudy)||void 0===t?void 0:t.series;if(n){var a=L(n);if(a){var r=i.state.activeSeries,o=a.findIndex((function(e){return e.uid===(null===r||void 0===r?void 0:r.uid)}));o>=0&&(o+=e)>=0&&o<a.length&&i.onSeriesClick(a[o])}}},i.onClickTool=function(e){var t=i.viewportRef.current;switch(e){case _:case V:case $:case q:i.setState({activeTool:e});break;case Z:t.scaleToFit();break;case Q:t.scaleTo(1);break;case ee:t.rotateRight();break;case te:t.flipHorizontal();break;case ne:var n=!!i.state.cineMode;i.setState({cineMode:!n});break;case J:t.revert();break;case X:var a=!!i.state.showSidebar;i.setState({showSidebar:!a});break;case ie:var r=!!i.state.showInfo;i.setState({showInfo:!r});break;case ae:i.toggleFullScreen()}},i.onKeyDown=function(e){"c"===e.key?i.onClickTool(ne):"i"===e.key?i.onClickTool(ie):"s"===e.key?i.onClickTool(_):"w"===e.key?i.onClickTool(V):"z"!==e.key||e.ctrlKey?"f"===e.key?i.onClickTool(Z):"Escape"===e.key?i.onClickTool(J):"ArrowLeft"===e.key||"ArrowUp"===e.key?i.scrollFrame(-1):"ArrowRight"===e.key||"ArrowDown"===e.key?i.scrollFrame(1):"PageUp"===e.key?i.scrollSeries(-1):"PageDown"===e.key?i.scrollSeries(1):"F11"===e.key&&(e.preventDefault(),i.toggleFullScreen()):i.onClickTool($)},i.onSplitDragEnd=function(e){M(e)&&i.setState({splitSizes:e})},i.onAcceptClick=function(e){i.setState({showSafetyAlert:!1})},i.onDeclineClick=function(e){window&&window.history&&window.history.back()},i.onFullScreenChange=function(e){var t=y.a.isFullscreen;i.setState({fullScreen:t})},i.toggleFullScreen=function(){y.a.isEnabled&&y.a.toggle()},i.renderLoader=function(){return a.a.createElement(m.a,{className:"app app-container"},a.a.createElement("div",{className:"app-loader fit-width fot-height"},a.a.createElement(g.a,{color:"#627FC0"})))},i.containerRef=a.a.createRef(),i.viewportRef=a.a.createRef(),i.state=Oe,i.state.showSafetyAlert=H(e.showSafetyAlert),i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(window&&window.addEventListener&&window.addEventListener("resize",this.onResize),y.a.isEnabled&&(y.a.onChange=this.onFullScreenChange),this.verifyParameters(this.props)){var t=!!(this.props.keyImagesOnly&&this.props.keyImagesOnly.length>0)&&H(this.props.keyImagesOnly),n=null;this.setState({loading:!0}),Te.getPatientInfo(Object(c.a)({},this.props)).then((function(i){if(0===i.patients.length)return e.setState({error:"No study found"});if(i.patients.length>1)return e.setState({error:"More the one patient found"});var a=i.patients[0];e.setState(Object(c.a)(Object(c.a)({},e.state),{},{patient:a}));var r=a.studies;A(r)&&(e.onStudyClick(r[0]),r.forEach((function(i){var r=i.uid;if(!i.isOffline()&&A(i.series)){var o=i.series.some((function(e){return"KO"===e.modality}));i.series.forEach((function(c){var s=c.uid;Te.getInstances({studyUID:r,seriesUID:s}).then((function(s){var l=s.patients;if(l&&1===l.length&&l[0].patientID===a.patientID&&l[0].studies&&1===l[0].studies.length){var u=l[0].studies[0].series[0];u&&u.instances&&("KO"===u.modality?(e.removeSeries(i,u),A(u.instances)&&u.instances.forEach((function(a){c=e.convertKOInstanceToSeries(a,l,i,c),i.series.push(c),n||(n=e.checkActiveImage(r,c,o,t,n,i,!0))}))):(c.instances=u.instances,A(c.instances)&&!n&&(n=e.checkActiveImage(r,c,o,t,n,i,!1)))),o&&e.sortKOSeries(i,t)}}))}))}})))})).then((function(t){return e.setState({loading:!1})})).catch((function(t){e.setState({error:t.message,errorInfo:t.stack,loading:!1}),console.log("error laoding patient info, cause: ",t)}))}else this.setState({error:"No filter found, please check configuration"})}},{key:"removeSeries",value:function(e,t){e.series=e.series.filter((function(e){return e.uid!==t.uid}))}},{key:"convertKOInstanceToSeries",value:function(e,t,n,i){var a=Ee.KoSeries(e);return this.checkKODateTime(a,t[0].studies),this.getReferencedSeries(e,n),a.instances=e.referencedInstances,a}},{key:"checkKODateTime",value:function(e,t){e.contentDate&&e.contentTime&&t.date&&t.time&&e.contentDate===t.date&&e.contentTime===t.time&&(e.description=e.codeMeaning)}},{key:"getReferencedSeries",value:function(e,t){e.referencedInstances.forEach((function(e){var n=t.series.find((function(t){return t.uid===e.referencedSeriesUID}));n&&(e.referencedSeries={modality:n.modality,description:n.description})}))}},{key:"sortKOSeries",value:function(e,t){var n=e.series.filter((function(e){return"KO"===e.modality})),i=e.series.filter((function(e){return"KO"!==e.modality}));e.series=t?n.concat(i):i.concat(n)}},{key:"checkActiveImage",value:function(e,t,n,i,a,r,o){if(!this.props.studyUID||this.props.studyUID===e){var c=t.instances.find((function(e){return e.rows>0}));c&&(o&&i||!o&&(!n||!i))&&(a=c,this.setState({loading:!1,activeStudy:r,activeSeries:t,activeImage:a}))}return a}},{key:"componentWillUnmount",value:function(){window&&window.removeEventListener&&window.removeEventListener("resize",this.onResize)}},{key:"componentDidCatch",value:function(e,t){this.setState({error:e,errorInfo:t})}},{key:"render",value:function(){var e,t=this.state;if(t.error)return a.a.createElement(f.a,{variant:"danger"},a.a.createElement(f.a.Heading,null,t.error),a.a.createElement("p",null,t.errorInfo||""));if(t.loading)return this.renderLoader();if(!(null===(e=t.patient)||void 0===e?void 0:e.studies))return a.a.createElement(m.a,{className:"app app-container"});var n=t.headerHeight||0,i=t.headerTop+t.headerHeight||0;return a.a.createElement(w.a,{handleHeight:!0,onResize:this.onResize,targetRef:this.containerRef},a.a.createElement(ve,{key:"safetyAlert",onAcceptClick:this.onAcceptClick,onDeclineClick:this.onDeclineClick,show:t.showSafetyAlert}),a.a.createElement(m.a,{key:"appContainer",ref:this.containerRef,className:"app app-container d-flex flex-column",tabIndex:0,onKeyDown:this.onKeyDown},a.a.createElement(fe,{key:"appHeader",id:"header",patient:t.patient,activeTool:t.activeTool,onClickTool:this.onClickTool,cineMode:t.cineMode,showSidebar:t.showSidebar,showInfo:t.showInfo,fullScreen:t.fullScreen,fullScreenEnabled:t.fullScreenEnabled}),a.a.createElement("span",{style:{height:"".concat(n,"px"),width:"100%"}}),a.a.createElement(p.a,{className:"app-main m-0 p-0 flex-fill",style:{maxHeight:"calc(100vh - ".concat(i,"px")}},a.a.createElement(h.a,{className:"app-gutter d-flex fit-width fit-height",minSize:0,sizes:t.showSidebar?t.splitSizes:[0,100],gutterSize:t.showSidebar?8:0,onDragEnd:this.onSplitDragEnd},a.a.createElement("div",{className:"fit-height"},t.showSidebar&&a.a.createElement(G,{id:"sidebar",studies:t.patient.studies,activeStudy:t.activeStudy,activeSeries:t.activeSeries,activeImage:t.activeImage,onStudyClick:this.onStudyClick,onSeriesClick:this.onSeriesClick,onImageClick:this.onImageClick})),a.a.createElement("div",{className:"app-viewer fit-height"},a.a.createElement(se,{id:"viewport",ref:this.viewportRef,patient:t.patient,study:t.activeStudy,series:t.activeSeries,image:t.activeImage,scrollFrame:this.scrollFrame,activeTool:t.activeTool,showInfo:t.showInfo,cineMode:t.cineMode}))))))}}]),n}(a.a.Component);Ne.defaultProps={isNotO3DPACS:!1,showOnlyThis:!0,showSafetyAlert:!0,keyImagesOnly:!1};var xe=Ne;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var De,Fe={},Pe=window.frameElement;if(!Pe)throw new Error("Invalid frameElement");Fe.patientID=Pe.getAttribute("patientID"),Fe.idIssuer=Pe.getAttribute("idIssuer"),Fe.accessionNumber=Pe.getAttribute("accessionNumber"),Fe.studyUID=Pe.getAttribute("studyUID"),Fe.showOnlyThis=Pe.getAttribute("showOnlyThis"),Fe.isNotO3DPACS=Pe.getAttribute("isNotO3DPACS"),Fe.retrieveAeTitle=Pe.getAttribute("retrieveAeTitle"),Fe.serviceUrl=function(e){if("string"===typeof e)return e.replace(/\/+$/,"")}(Pe.getAttribute("serviceURL")),Fe.keyImagesOnly=Pe.getAttribute("keyImagesOnly"),(De=Pe.getAttribute("credentials"))&&(Se.authorization="Basic ".concat(De)),Fe.retrieveAeTitle&&(Te.retrieveAeTitle=Fe.retrieveAeTitle),Fe.serviceUrl&&(Te.serviceUrl=Fe.serviceUrl),o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(xe,Fe)),document.getElementById("html-viewer")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[270,1,2]]]);